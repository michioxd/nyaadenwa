!function(){"use strict";function e(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}const t=1748121140,i=1748121141,r=6387249,{WritableStream:n}=globalThis;class o{#e;#t;#i=0;#r=7;get byteAligned(){return 7===this.#r}get ended(){return this.#i>=this.#e.length}constructor(e){this.#e=e,this.#t=e[0]}f1(){const e=this.#t>>this.#r;return this.#r-=1,this.#r<0&&(this.#i+=1,this.#r=7,this.#t=this.#e[this.#i]),1&e}f(e){let t=0;for(;e>0;e-=1)t<<=1,t|=this.f1();return t}skip(e){if(e<=this.#r+1)return this.#i+=1,this.#r=7,void(this.#t=this.#e[this.#i]);e-=this.#r+1,this.#i+=1;const t=e/8|0;t>0&&(this.#i+=t,e-=8*t),this.#r=7-e,this.#t=this.#e[this.#i]}readBytes(e){if(!this.byteAligned)throw new Error("Bytes must be byte-aligned");const t=this.#e.subarray(this.#i,this.#i+e);return this.#i+=e,this.#t=this.#e[this.#i],t}getPosition(){return[this.#i,this.#r]}setPosition([e,t]){this.#i=e,this.#r=t,this.#t=this.#e[e]}}const a={SequenceHeader:1,TemporalDelimiter:2,FrameHeader:3,TileGroup:4,Metadata:5,Frame:6,RedundantFrameHeader:7,TileList:8,Padding:15},s={Bt709:1,Unspecified:2,Bt470M:4,Bt470BG:5,Bt601:6,Smpte240:7,GenericFilm:8,Bt2020:9,Xyz:10,Smpte431:11,Smpte432:12,Ebu3213:22},_={Bt709:1,Unspecified:2,Bt470M:4,Bt470BG:5,Bt601:6,Smpte240:7,Linear:8,Log100:9,Log100Sqrt10:10,Iec61966:11,Bt1361:12,Srgb:13,Bt2020Ten:14,Bt2020Twelve:15,Smpte2084:16,Smpte428:17,Hlg:18},c={Identity:0,Bt709:1,Unspecified:2,Fcc:4,Bt470BG:5,Bt601:6,Smpte240:7,YCgCo:8,Bt2020Ncl:9,Bt2020Cl:10,Smpte2085:11,ChromatNcl:12,ChromatCl:13,ICtCp:14};class l extends o{static ObuType=a;static ColorPrimaries=s;static TransferCharacteristics=_;static MatrixCoefficients=c;#n=0;uvlc(){let e=0;for(;!this.f1();)e+=1;if(e>=32)return 2**32-1;return this.f(e)+(1<<e>>>0)-1}leb128(){if(!this.byteAligned)throw new Error("LEB128 must be byte-aligned");let e=0n;this.#n=0;for(let t=0n;t<8n;t+=1n){const i=this.f(8);if(e|=BigInt(127&i)<<7n*t,this.#n+=1,!(128&i))break}return e}*annexBBitstream(){for(;!this.ended;){const e=this.leb128();yield*this.temporalUnit(e)}}*temporalUnit(e){for(;e>0;){const t=this.leb128();e-=BigInt(this.#n),yield*this.frameUnit(t),e-=t}}*frameUnit(e){for(;e>0;){const t=this.leb128();e-=BigInt(this.#n);const i=this.openBitstreamUnit(t);i&&(yield i),e-=t}}#o=0;openBitstreamUnit(e){const t=this.obuHeader();let i;if(t.obu_has_size_field)i=this.leb128();else{if(void 0===e)throw new Error("obu_has_size_field must be true");i=e-1n-(t.obu_extension_flag?1n:0n)}const r=this.getPosition();if(t.obu_type!==l.ObuType.SequenceHeader&&t.obu_type!==l.ObuType.TemporalDelimiter&&0!==this.#o&&t.obu_extension_header){const e=!!(this.#o&1<<t.obu_extension_header.temporal_id),r=!!(this.#o&1<<t.obu_extension_header.spatial_id+8);if(!e||!r)return void this.skip(Number(i))}let n;if(t.obu_type===l.ObuType.SequenceHeader)n=this.sequenceHeaderObu();const o=this.getPosition(),a=8*(o[0]-r[0])+(r[1]-o[1]);return i>0&&this.skip(8*Number(i)-a),{obu_header:t,obu_size:i,sequence_header_obu:n}}obuHeader(){if(!!this.f1())throw new Error("Invalid data");const e=this.f(4),t=!!this.f1(),i=!!this.f1();let r;return this.f1(),t&&(r=this.obuExtensionHeader()),{obu_type:e,obu_extension_flag:t,obu_has_size_field:i,obu_extension_header:r}}obuExtensionHeader(){const e=this.f(3),t=this.f(2);return this.skip(3),{temporal_id:e,spatial_id:t}}static SelectScreenContentTools=2;static SelectIntegerMv=2;sequenceHeaderObu(){const e=this.f(3),t=!!this.f1(),i=!!this.f1();let r,n,o=!1,a=!1,s=!1,_=0;const c=[],d=[],f=[],u=[],m=[];let h,p;if(i)c[0]=0,d[0]=this.f(5),f[0]=0,u[0]=!1,m[0]=!1;else{o=!!this.f1(),o&&(r=this.timingInfo(),a=!!this.f1(),a&&(n=this.decoderModelInfo(),h=[])),s=!!this.f1(),s&&(p=[]),_=this.f(5);for(let e=0;e<=_;e+=1)c[e]=this.f(12),d[e]=this.f(5),d[e]>7?f[e]=this.f1():f[e]=0,a?(u[e]=!!this.f1(),u[e]&&(h[e]=this.operatingParametersInfo(n))):u[e]=!1,s&&(m[e]=!!this.f1(),m[e]&&(p[e]=this.f(4)))}const b=this.chooseOperatingPoint();this.#o=c[b];const g=this.f(4),x=this.f(4),E=this.f(g+1),T=this.f(x+1);let v,y,P=!1;i||(P=!!this.f1(),P&&(v=this.f(4),y=this.f(3)));const w=!!this.f1(),R=!!this.f1(),A=!!this.f1();let S,U=!1,G=!1,N=!1,L=!1,C=!1,I=!1,B=!1,D=!1,F=l.SelectScreenContentTools,X=!1,k=l.SelectIntegerMv;i||(U=!!this.f1(),G=!!this.f1(),N=!!this.f1(),L=!!this.f1(),C=!!this.f1(),C&&(I=!!this.f1(),B=!!this.f1()),D=!!this.f1(),D||(F=this.f1()),F>0&&(X=!!this.f1(),X||(k=this.f1())),C&&(S=this.f(3)));return{seq_profile:e,still_picture:t,reduced_still_picture_header:i,timing_info_present_flag:o,timing_info:r,decoder_model_info_present_flag:a,decoder_model_info:n,initial_display_delay_present_flag:s,initial_display_delay_minus_1:p,operating_points_cnt_minus_1:_,operating_point_idc:c,seq_level_idx:d,seq_tier:f,decoder_model_present_for_this_op:u,operating_parameters_info:h,initial_display_delay_present_for_this_op:m,frame_width_bits_minus_1:g,frame_height_bits_minus_1:x,max_frame_width_minus_1:E,max_frame_height_minus_1:T,frame_id_numbers_present_flag:P,delta_frame_id_length_minus_2:v,additional_frame_id_length_minus_1:y,use_128x128_superblock:w,enable_filter_intra:R,enable_intra_edge_filter:A,enable_interintra_compound:U,enable_masked_compound:G,enable_warped_motion:N,enable_dual_filter:L,enable_order_hint:C,enable_jnt_comp:I,enable_ref_frame_mvs:B,seq_choose_screen_content_tools:D,seq_force_screen_content_tools:F,seq_choose_integer_mv:X,seq_force_integer_mv:k,order_hint_bits_minus_1:S,enable_superres:!!this.f1(),enable_cdef:!!this.f1(),enable_restoration:!!this.f1(),color_config:this.colorConfig(e),film_grain_params_present:!!this.f1()}}searchSequenceHeaderObu(){for(;!this.ended;){const e=this.openBitstreamUnit();if(e&&e.sequence_header_obu)return e.sequence_header_obu}}timingInfo(){const e=this.f(32),t=this.f(32),i=!!this.f1();let r;return i&&(r=this.uvlc()),{num_units_in_display_tick:e,time_scale:t,equal_picture_interval:i,num_ticks_per_picture_minus_1:r}}decoderModelInfo(){return{buffer_delay_length_minus_1:this.f(5),num_units_in_decoding_tick:this.f(32),buffer_removal_time_length_minus_1:this.f(5),frame_presentation_time_length_minus_1:this.f(5)}}operatingParametersInfo(e){const t=e.buffer_delay_length_minus_1+1;return{decoder_buffer_delay:this.f(t),encoder_buffer_delay:this.f(t),low_delay_mode_flag:!!this.f1()}}chooseOperatingPoint(){return 0}colorConfig(e){const t=!!this.f1();let i=!1,r=8;2===e&&t?(i=!!this.f1(),r=i?12:10):e<=2&&(r=t?10:8);let n=!1;1===e&&(n=!!this.f1());const o=!!this.f1();let a=l.ColorPrimaries.Unspecified,s=l.TransferCharacteristics.Unspecified,_=l.MatrixCoefficients.Unspecified;o&&(a=this.f(8),s=this.f(8),_=this.f(8));let c,d,f=!1,u=0,m=!1;if(n)f=!!this.f1(),c=!0,d=!0;else{if(a===l.ColorPrimaries.Bt709&&s===l.TransferCharacteristics.Srgb&&_===l.MatrixCoefficients.Identity)f=!0,c=!1,d=!1;else{switch(f=!!this.f1(),e){case 0:c=!0,d=!0;break;case 1:c=!1,d=!1;break;default:12==r?(c=!!this.f1(),d=!!c&&!!this.f1()):(c=!0,d=!1)}c&&d&&(u=this.f(2))}m=!!this.f1()}return{high_bitdepth:t,twelve_bit:i,BitDepth:r,mono_chrome:n,color_description_present_flag:o,color_primaries:a,transfer_characteristics:s,matrix_coefficients:_,color_range:f,subsampling_x:c,subsampling_y:d,chroma_sample_position:u,separate_uv_delta_q:m}}}function*d(e){let t=-1,i=0,r=!1;for(let n=0;n<e.length;n+=1){const o=e[n];if(r){if(o>3)throw new Error("Invalid data");r=!1;continue}if(0===o){i+=1;continue}const a=i;if(i=0,-1===t){if(a>=2&&1===o){t=n+1;continue}throw new Error("Invalid data")}if(!(a<2))if(1!==o){if(a>2)throw new Error("Invalid data");switch(o){case 2:throw new Error("Invalid data");case 3:r=!0}}else yield e.subarray(t,n-a),t=n+1}if(r)throw new Error("Invalid data");yield e.subarray(t,e.length)}class f{#a;#s;#_;#c=0;#i=0;#r=7;#t=0;get byteLength(){return this.#s}get stopBitIndex(){return this.#_}get bytePosition(){return this.#i}get bitPosition(){return this.#r}get ended(){return this.#i>=this.#s&&this.#r<=this.#_}constructor(e){this.#a=e;for(let t=e.length-1;t>=0;t-=1){if(0===this.#a[t])continue;const i=e[t];for(let e=0;e<8;e+=1)if(1==(i>>e&1))return this.#s=t,this.#_=e,void this.#l()}throw new Error("Stop bit not found")}#l(){if(this.#t=this.#a[this.#i],2===this.#c&&3===this.#t)return this.#c=0,this.#i+=1,void this.#l();0===this.#t?this.#c+=1:this.#c=0}next(){if(this.ended)throw new Error("Bit index out of bounds");const e=this.#t>>this.#r&1;return this.#r-=1,this.#r<0&&(this.#i+=1,this.#r=7,this.#l()),e}read(e){if(e>32)throw new Error("Read length too large");let t=0;for(let i=0;i<e;i+=1)t=t<<1|this.next();return t}#d(){if(this.#i>=this.#s&&this.#r<this.#_)throw new Error("Bit index out of bounds")}skip(e){if(e<=this.#r+1)return this.#r-=e,void this.#d();for(e-=this.#r+1,this.#i+=1,this.#r=7,this.#l(),this.#d();e>=8;e-=8)this.#i+=1,this.#l(),this.#d();this.#r=7-e,this.#d()}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}#f(){return{zeroCount:this.#c,bytePosition:this.#i,bitPosition:this.#r,byte:this.#t}}#u(e){this.#c=e.zeroCount,this.#i=e.bytePosition,this.#r=e.bitPosition,this.#t=e.byte}peek(e){const t=this.#f(),i=this.read(e);return this.#u(t),i}readBytes(e){const t=new Uint8Array(e);for(let i=0;i<e;i+=1)t[i]=this.read(8);return t}peekBytes(e){const t=this.#f(),i=this.readBytes(e);return this.#u(t),i}}function u(e){const{sequenceParameterSet:t,pictureParameterSet:i}=function(e){let t,i;for(const r of d(e))switch(31&r[0]){case 7:if(t=r,i)return{sequenceParameterSet:t,pictureParameterSet:i};break;case 8:if(i=r,t)return{sequenceParameterSet:t,pictureParameterSet:i}}throw new Error("Invalid data")}(e),{profile_idc:r,constraint_set:n,level_idc:o,pic_width_in_mbs_minus1:a,pic_height_in_map_units_minus1:s,frame_mbs_only_flag:_,frame_crop_left_offset:c,frame_crop_right_offset:l,frame_crop_top_offset:u,frame_crop_bottom_offset:m}=function(e){const t=new f(e);if(0!==t.next())throw new Error("Invalid data");const i=t.read(2);if(7!==t.read(5))throw new Error("Invalid data");if(0===i)throw new Error("Invalid data");const r=t.read(8),n=t.peek(8),o=!!t.next(),a=!!t.next(),s=!!t.next(),_=!!t.next(),c=!!t.next(),l=!!t.next();if(0!==t.read(2))throw new Error("Invalid data");const d=t.read(8),u=t.decodeExponentialGolombNumber();if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||139===r||134===r){const e=t.decodeExponentialGolombNumber();if(3===e&&t.next(),t.decodeExponentialGolombNumber(),t.decodeExponentialGolombNumber(),t.next(),t.next())for(let i=0;i<(3!==e?8:12);i+=1)t.next()}t.decodeExponentialGolombNumber();const m=t.decodeExponentialGolombNumber();if(0===m)t.decodeExponentialGolombNumber();else if(1===m){t.next(),t.decodeExponentialGolombNumber(),t.decodeExponentialGolombNumber();const e=t.decodeExponentialGolombNumber();for(let i=0;i<e;i+=1)t.decodeExponentialGolombNumber()}t.decodeExponentialGolombNumber(),t.next();const h=t.decodeExponentialGolombNumber(),p=t.decodeExponentialGolombNumber(),b=t.next();b||t.next(),t.next();const g=!!t.next();let x,E,T,v;return g?(x=t.decodeExponentialGolombNumber(),E=t.decodeExponentialGolombNumber(),T=t.decodeExponentialGolombNumber(),v=t.decodeExponentialGolombNumber()):(x=0,E=0,T=0,v=0),t.next(),{profile_idc:r,constraint_set:n,constraint_set0_flag:o,constraint_set1_flag:a,constraint_set2_flag:s,constraint_set3_flag:_,constraint_set4_flag:c,constraint_set5_flag:l,level_idc:d,seq_parameter_set_id:u,pic_width_in_mbs_minus1:h,pic_height_in_map_units_minus1:p,frame_mbs_only_flag:b,frame_cropping_flag:g,frame_crop_left_offset:x,frame_crop_right_offset:E,frame_crop_top_offset:T,frame_crop_bottom_offset:v}}(t),h=16*(a+1),p=(s+1)*(2-_)*16,b=2*c,g=2*l,x=2*u,E=2*m;return{pictureParameterSet:i,sequenceParameterSet:t,profileIndex:r,constraintSet:n,levelIndex:o,encodedWidth:h,encodedHeight:p,cropLeft:b,cropRight:g,cropTop:x,cropBottom:E,croppedWidth:h-b-g,croppedHeight:p-x-E}}function m(e){const t=new f(e);if(0!==t.next())throw new Error("Invalid NALU header");return{nal_unit_type:t.read(6),nuh_layer_id:t.read(6),nuh_temporal_id_plus1:t.read(3)}}function h(e){const t=new f(e),i=t.read(4),r=t.read(3),n=!!t.next(),o=b(t,!0,r),a=t.decodeExponentialGolombNumber(),s=t.decodeExponentialGolombNumber();let _;3===s&&(_=!!t.next());const c=t.decodeExponentialGolombNumber(),l=t.decodeExponentialGolombNumber(),d=!!t.next();let u,m,h,p;d&&(u=t.decodeExponentialGolombNumber(),m=t.decodeExponentialGolombNumber(),h=t.decodeExponentialGolombNumber(),p=t.decodeExponentialGolombNumber());const T=t.decodeExponentialGolombNumber(),v=t.decodeExponentialGolombNumber(),y=t.decodeExponentialGolombNumber(),P=[],w=[],R=[],A=!!t.next();for(let f=A?0:r;f<=r;f+=1)P[f]=t.decodeExponentialGolombNumber(),w[f]=t.decodeExponentialGolombNumber(),R[f]=t.decodeExponentialGolombNumber();const S=t.decodeExponentialGolombNumber(),U=t.decodeExponentialGolombNumber(),G=t.decodeExponentialGolombNumber(),N=t.decodeExponentialGolombNumber(),L=t.decodeExponentialGolombNumber(),C=t.decodeExponentialGolombNumber(),I=!!t.next();let B,D;I&&(B=!!t.next(),B&&(D=function(e){const t=[];for(let i=0;i<4;i+=1){t[i]=[];for(let r=0;r<6;r+=3===i?3:1){if(!!e.next()){let n=8;const o=Math.min(64,1<<4+(i<<1));if(i>1){n=e.decodeExponentialGolombNumber()+8}t[i][r]=[];for(let a=0;a<o;a+=1){n=(n+e.decodeExponentialGolombNumber()+256)%256,t[i][r][a]=n}}else e.decodeExponentialGolombNumber()}}return t}(t)));const F=!!t.next(),X=!!t.next(),k=!!t.next();let M,z,H,O,W;k&&(M=t.read(4),z=t.read(4),H=t.decodeExponentialGolombNumber(),O=t.decodeExponentialGolombNumber(),W=!!t.next());const Y=t.decodeExponentialGolombNumber(),q=[];for(let f=0;f<Y;f+=1)q[f]=g(t,f,Y,q);const V=!!t.next();let j,K,$;if(V){j=t.decodeExponentialGolombNumber(),K=[],$=[];for(let e=0;e<j;e+=1)K[e]=t.read(y+4),$[e]=!!t.next()}const J=!!t.next(),Q=!!t.next(),Z=!!t.next();let ee;Z&&(ee=function(e,t){const i=!!e.next();let r,n,o;i&&(r=e.read(8),r===x.Extended&&(n=e.read(16),o=e.read(16)));const a=!!e.next();let s;a&&(s=!!e.next());const _=!!e.next();let c,l,d,f,u,m;_&&(c=e.read(3),l=!!e.next(),d=!!e.next(),d&&(f=e.read(8),u=e.read(8),m=e.read(8)));const h=!!e.next();let p,b;h&&(p=e.decodeExponentialGolombNumber(),b=e.decodeExponentialGolombNumber());const g=!!e.next(),T=!!e.next(),v=!!e.next(),y=!!e.next();let P,w,R,A;y&&(P=e.decodeExponentialGolombNumber(),w=e.decodeExponentialGolombNumber(),R=e.decodeExponentialGolombNumber(),A=e.decodeExponentialGolombNumber());const S=!!e.next();let U,G,N,L,C,I;S&&(U=e.read(32),G=e.read(32),N=!!e.next(),N&&(L=e.decodeExponentialGolombNumber()),C=!!e.next(),C&&(I=E(e,!0,t)));const B=!!e.next();let D,F,X,k,M,z,H,O;B&&(D=!!e.next(),F=!!e.next(),X=!!e.next(),k=e.decodeExponentialGolombNumber(),M=e.decodeExponentialGolombNumber(),z=e.decodeExponentialGolombNumber(),H=e.decodeExponentialGolombNumber(),O=e.decodeExponentialGolombNumber());return{aspect_ratio_info_present_flag:i,aspect_ratio_idc:r,sar_width:n,sar_height:o,overscan_info_present_flag:a,overscan_appropriate_flag:s,video_signal_type_present_flag:_,video_format:c,video_full_range_flag:l,colour_description_present_flag:d,colour_primaries:f,transfer_characteristics:u,matrix_coeffs:m,chroma_loc_info_present_flag:h,chroma_sample_loc_type_top_field:p,chroma_sample_loc_type_bottom_field:b,neutral_chroma_indication_flag:g,field_seq_flag:T,frame_field_info_present_flag:v,default_display_window_flag:y,def_disp_win_left_offset:P,def_disp_win_right_offset:w,def_disp_win_top_offset:R,def_disp_win_bottom_offset:A,vui_timing_info_present_flag:S,vui_num_units_in_tick:U,vui_time_scale:G,vui_poc_proportional_to_timing_flag:N,vui_num_ticks_poc_diff_one_minus1:L,vui_hrd_parameters_present_flag:C,vui_hrd_parameters:I,bitstream_restriction_flag:B,tiles_fixed_structure_flag:D,motion_vectors_over_pic_boundaries_flag:F,restricted_ref_pic_lists_flag:X,min_spatial_segmentation_idc:k,max_bytes_per_pic_denom:M,max_bits_per_min_cu_denom:z,log2_max_mv_length_horizontal:H,log2_max_mv_length_vertical:O}}(t,r));const te=!!t.next();let ie,re,ne,oe,ae,se,_e,ce;if(te&&(ie=!!t.next(),re=!!t.next(),ne=!!t.next(),oe=!!t.next(),ae=t.read(4)),ie)throw new Error("Not implemented");if(re&&(se=function(e){const t=!!e.next();return{inter_view_mv_vert_constraint_flag:t}}(t)),ne&&(_e=function(e){const t=[],i=[];t[0]=!!e.next(),i[0]=!!e.next();const r=e.decodeExponentialGolombNumber(),n=!!e.next(),o=!!e.next(),a=!!e.next(),s=!!e.next();t[1]=!!e.next(),i[1]=!!e.next();const _=!!e.next(),c=e.decodeExponentialGolombNumber(),l=!!e.next(),d=!!e.next(),f=!!e.next(),u=!!e.next(),m=!!e.next();return{iv_di_mc_enabled_flag:t,iv_mv_scal_enabled_flag:i,log2_ivmc_sub_pb_size_minus3:r,iv_res_pred_enabled_flag:n,depth_ref_enabled_flag:o,vsp_mc_enabled_flag:a,dbbp_enabled_flag:s,tex_mc_enabled_flag:_,log2_texmc_sub_pb_size_minus3:c,intra_contour_enabled_flag:l,intra_dc_only_wedge_enabled_flag:d,cqt_cu_part_pred_enabled_flag:f,inter_dc_only_enabled_flag:u,skip_intra_enabled_flag:m}}(t)),oe)throw new Error("Not implemented");if(ae){ce=[];let e=0;for(;!t.ended;)ce[e]=!!t.next(),e+=1}return{sps_video_parameter_set_id:i,sps_max_sub_layers_minus1:r,sps_temporal_id_nesting_flag:n,profileTierLevel:o,sps_seq_parameter_set_id:a,chroma_format_idc:s,separate_colour_plane_flag:_,pic_width_in_luma_samples:c,pic_height_in_luma_samples:l,conformance_window_flag:d,conf_win_left_offset:u,conf_win_right_offset:m,conf_win_top_offset:h,conf_win_bottom_offset:p,bit_depth_luma_minus8:T,bit_depth_chroma_minus8:v,log2_max_pic_order_cnt_lsb_minus4:y,sps_sub_layer_ordering_info_present_flag:A,sps_max_dec_pic_buffering_minus1:P,sps_max_num_reorder_pics:w,sps_max_latency_increase_plus1:R,log2_min_luma_coding_block_size_minus3:S,log2_diff_max_min_luma_coding_block_size:U,log2_min_luma_transform_block_size_minus2:G,log2_diff_max_min_luma_transform_block_size:N,max_transform_hierarchy_depth_inter:L,max_transform_hierarchy_depth_intra:C,scaling_list_enabled_flag:I,sps_scaling_list_data_present_flag:B,scalingListData:D,amp_enabled_flag:F,sample_adaptive_offset_enabled_flag:X,pcm_enabled_flag:k,pcm_sample_bit_depth_luma_minus1:M,pcm_sample_bit_depth_chroma_minus1:z,log2_min_pcm_luma_coding_block_size_minus3:H,log2_diff_max_min_pcm_luma_coding_block_size:O,pcm_loop_filter_disabled_flag:W,num_short_term_ref_pic_sets:Y,shortTermRefPicSets:q,long_term_ref_pics_present_flag:V,num_long_term_ref_pics_sps:j,lt_ref_pic_poc_lsb_sps:K,used_by_curr_pic_lt_sps_flag:$,sps_temporal_mvp_enabled_flag:J,strong_intra_smoothing_enabled_flag:Q,vui_parameters_present_flag:Z,vuiParameters:ee,sps_extension_present_flag:te,sps_range_extension_flag:ie,sps_multilayer_extension_flag:re,sps_3d_extension_flag:ne,sps_scc_extension_flag:oe,sps_extension_4bits:ae,spsMultilayerExtension:se,sps3dExtension:_e,sps_extension_data_flag:ce}}function p(e){const t=e.read(2),i=!!e.next(),r=e.read(5),n=e.peekBytes(4),o=[];for(let v=0;v<32;v+=1)o[v]=!!e.next();const a=e.peekBytes(6),s=!!e.next(),_=!!e.next(),c=!!e.next(),l=!!e.next();let d,f,u,m,h,p,b,g,x,E,T;return 4===r||o[4]||5===r||o[5]||6===r||o[6]||7===r||o[7]||8===r||o[8]||9===r||o[9]||10===r||o[10]||11===r||o[11]?(d=!!e.next(),f=!!e.next(),u=!!e.next(),m=!!e.next(),h=!!e.next(),p=!!e.next(),b=!!e.next(),g=!!e.next(),x=!!e.next(),5===r||o[5]||9===r||o[9]||10===r||o[10]||11===r||o[11]?(E=!!e.next(),e.skip(33)):e.skip(34)):2===r||o[2]?(e.skip(7),g=!!e.next(),e.skip(35)):e.skip(43),1===r||o[1]||2===r||o[2]||3===r||o[3]||4===r||o[4]||5===r||o[5]||9===r||o[9]||11===r||o[11]?T=!!e.next():e.skip(1),{profile_space:t,tier_flag:i,profile_idc:r,profileCompatibilitySet:n,profile_compatibility_flag:o,constraintSet:a,progressive_source_flag:s,interlaced_source_flag:_,non_packed_constraint_flag:c,frame_only_constraint_flag:l,max_12bit_constraint_flag:d,max_10bit_constraint_flag:f,max_8bit_constraint_flag:u,max_422chroma_constraint_flag:m,max_420chroma_constraint_flag:h,max_monochrome_constraint_flag:p,intra_constraint_flag:b,one_picture_only_constraint_flag:g,lower_bit_rate_constraint_flag:x,max_14bit_constraint_flag:E,inbld_flag:T}}function b(e,t,i){let r;r=p(e);const n=e.read(8),o=[],a=[];for(let c=0;c<i;c+=1)o[c]=!!e.next(),a[c]=!!e.next();if(i>0)for(let c=i;c<8;c+=1)e.read(2);const s=[],_=[];for(let c=0;c<i;c+=1)o[c]&&(s[c]=p(e)),a[c]&&(_[c]=e.read(8));return{generalProfileTier:r,general_level_idc:n,sub_layer_profile_present_flag:o,sub_layer_level_present_flag:a,subLayerProfileTier:s,sub_layer_level_idc:_}}function g(e,t,i,r){let n=!1;0!==t&&(n=!!e.next());let o=0,a=!1,s=0;const _=[],c=[];let l=0,d=0;const f=[],u=[],m=[],h=[];if(n){t===i&&(o=e.decodeExponentialGolombNumber()),a=!!e.next(),s=e.decodeExponentialGolombNumber();const n=r[t-(o+1)],p=n.num_negative_pics+n.num_positive_pics;for(let t=0;t<=p;t+=1)_[t]=!!e.next(),_[t]?c[t]=!0:c[t]=!!e.next();const b=(1-2*Number(a))*(s+1),g=[],x=[],E=[],T=[];let v=0;for(let e=0;e<n.num_negative_pics;e+=1)v-=n.delta_poc_s0_minus1[e]+1,g[e]=v;v=0;for(let e=0;e<n.num_positive_pics;e+=1)v+=n.delta_poc_s1_minus1[e]+1,x[e]=v;let y=0;if(n.num_positive_pics>0)for(let e=n.num_positive_pics-1;e>=0;e-=1)v=x[e]+b,v<0&&c[n.num_negative_pics+e]&&(E[y]=v,u[y]=_[n.num_negative_pics+e],y+=1);b<0&&c[p]&&(E[y]=b,u[y]=_[p],y+=1);for(let e=0;e<n.num_negative_pics;e+=1)v=g[e]+b,v<0&&c[e]&&(E[y]=v,u[y]=_[e],y+=1);l=y;let P=0;for(y=0;y<l;y+=1){const e=E[y];f[y]=-(e-P-1),P=e}if(y=0,n.num_negative_pics>0)for(let e=n.num_negative_pics-1;e>=0;e-=1)v=g[e]+b,v>0&&c[e]&&(T[y]=v,h[y]=_[e],y+=1);b>0&&c[p]&&(T[y]=b,h[y]=_[p],y+=1);for(let e=0;e<n.num_positive_pics;e+=1)v=x[e]+b,v>0&&c[n.num_negative_pics+e]&&(T[y]=v,h[y]=_[n.num_negative_pics+e],y+=1);for(d=y,P=0,y=0;y<d;y+=1){const e=T[y];m[y]=e-P-1,P=e}}else{l=e.decodeExponentialGolombNumber(),d=e.decodeExponentialGolombNumber();for(let t=0;t<l;t+=1)f[t]=e.decodeExponentialGolombNumber(),u[t]=!!e.next();for(let t=0;t<d;t+=1)m[t]=e.decodeExponentialGolombNumber(),h[t]=!!e.next()}return{stRpsIdx:t,num_short_term_ref_pic_sets:i,inter_ref_pic_set_prediction_flag:n,delta_idx_minus1:o,delta_rps_sign:a,abs_delta_rps_minus1:s,used_by_curr_pic_flag:_,use_delta_flag:c,num_negative_pics:l,num_positive_pics:d,delta_poc_s0_minus1:f,used_by_curr_pic_s0_flag:u,delta_poc_s1_minus1:m,used_by_curr_pic_s1_flag:h}}const x={Extended:255};function E(e,t,i){let r,n,o,a,s,_,c,l,d,f,u,m,h;t&&(r=!!e.next(),n=!!e.next(),(r||n)&&(o=!!e.next(),o&&(a=e.read(8),s=e.read(5),_=!!e.next(),c=e.read(5)),l=e.read(4),d=e.read(4),o&&(f=e.read(4)),u=e.read(5),m=e.read(5),h=e.read(5)));const p=[],b=[],g=[],x=[],E=[],y=[],P=[];for(let w=0;w<=i;w+=1)p[w]=!!e.next(),p[w]||(b[w]=!!e.next()),b[w]?g[w]=e.decodeExponentialGolombNumber():x[w]=!!e.next(),x[w]||(E[w]=e.decodeExponentialGolombNumber()),r&&(y[w]=T(e,w,v(E[w]))),n&&(P[w]=T(e,w,v(E[w])));return{nal_hrd_parameters_present_flag:r,vcl_hrd_parameters_present_flag:n,sub_pic_hrd_params_present_flag:o,tick_divisor_minus2:a,du_cpb_removal_delay_increment_length_minus1:s,sub_pic_cpb_params_in_pic_timing_sei_flag:_,dpb_output_delay_du_length_minus1:c,bit_rate_scale:l,cpb_size_scale:d,cpb_size_du_scale:f,initial_cpb_removal_delay_length_minus1:u,au_cpb_removal_delay_length_minus1:m,dpb_output_delay_length_minus1:h,fixed_pic_rate_general_flag:p,fixed_pic_rate_within_cvs_flag:b,elemental_duration_in_tc_minus1:g,low_delay_hrd_flag:x,cpb_cnt_minus1:E,nalHrdParameters:y,vclHrdParameters:P}}function T(e,t,i){const r=[],n=[],o=[];for(let a=0;a<i;a+=1)r[a]=e.decodeExponentialGolombNumber(),n[a]=e.decodeExponentialGolombNumber(),t>0&&(o[a]=!!e.next());return{bit_rate_value_minus1:r,cpb_size_value_minus1:n,cpb_size_du_value_minus1:[],bit_rate_du_value_minus1:[],cbr_flag:o}}function v(e){return e+1}function y(e){const{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r}=function(e){let t,i,r,n=0;for(const o of d(e)){const e=m(o),a={...e,data:o,rbsp:o.subarray(2)};switch(e.nal_unit_type){case 32:t=a;break;case 33:i=a;break;case 34:r=a;break;default:continue}if(n+=1,3===n)return{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r}}throw new Error("Invalid data")}(e),{profileTierLevel:{generalProfileTier:{profile_space:n,tier_flag:o,profile_idc:a,profileCompatibilitySet:s,constraintSet:_},general_level_idc:c}}=function(e){const t=new f(e),i=t.read(4),r=!!t.next(),n=!!t.next(),o=t.read(6),a=t.read(3),s=!!t.next();t.skip(16);const _=b(t,0,a),c=!!t.next(),l=[],d=[],u=[];for(let f=c?0:a;f<=a;f+=1)l[f]=t.decodeExponentialGolombNumber(),d[f]=t.decodeExponentialGolombNumber(),u[f]=t.decodeExponentialGolombNumber();const m=t.read(6),h=t.decodeExponentialGolombNumber(),p=[];for(let f=1;f<=h;f+=1){p[f]=[];for(let e=0;e<=m;e+=1)p[f][e]=!!t.next()}const g=!!t.next();let x,T,v,y,P,w,R,A;if(g){x=t.read(32),T=t.read(32),v=!!t.next(),v&&(y=t.decodeExponentialGolombNumber()),P=t.decodeExponentialGolombNumber(),w=[],R=[!0],A=[];for(let e=0;e<P;e+=1)w[e]=t.decodeExponentialGolombNumber(),e>0&&(R[e]=!!t.next()),A[e]=E(t,R[e],a)}return{vps_video_parameter_set_id:i,vps_base_layer_internal_flag:r,vps_base_layer_available_flag:n,vps_max_layers_minus1:o,vps_max_sub_layers_minus1:a,vps_temporal_id_nesting_flag:s,profileTierLevel:_,vps_sub_layer_ordering_info_present_flag:c,vps_max_dec_pic_buffering_minus1:l,vps_max_num_reorder_pics:d,vps_max_latency_increase_plus1:u,vps_max_layer_id:m,vps_num_layer_sets_minus1:h,layer_id_included_flag:p,vps_timing_info_present_flag:g,vps_num_units_in_tick:x,vps_time_scale:T,vps_poc_proportional_to_timing_flag:v,vps_num_ticks_poc_diff_one_minus1:y,vps_num_hrd_parameters:P,hrd_layer_set_idx:w,cprms_present_flag:R,hrdParameters:A,vps_extension_flag:!!t.next()}}(t.rbsp),{chroma_format_idc:l,pic_width_in_luma_samples:u,pic_height_in_luma_samples:p,conf_win_left_offset:g=0,conf_win_right_offset:x=0,conf_win_top_offset:T=0,conf_win_bottom_offset:v=0}=h(i.rbsp),y=function(e){switch(e){case 0:case 3:return 1;case 1:case 2:return 2;default:throw new Error("Invalid chroma_format_idc")}}(l),P=function(e){switch(e){case 0:case 2:case 3:return 1;case 1:return 2;default:throw new Error("Invalid chroma_format_idc")}}(l);return{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r,generalProfileSpace:n,generalProfileIndex:a,generalProfileCompatibilitySet:s,generalTierFlag:o,generalLevelIndex:c,generalConstraintSet:_,encodedWidth:u,encodedHeight:p,cropLeft:g,cropRight:x,cropTop:T,cropBottom:v,croppedWidth:u-y*(g+x),croppedHeight:p-P*(T+v)}}function P(e){return e.toString(16).toUpperCase()}function w(e){return e.toString(16).toUpperCase().padStart(2,"0")}function R(e){return e.toString(10).padStart(2,"0")}class A{#m;#h;constructor(e,t){this.#m=e,this.#h=t}#p(e){const t=new l(e).searchSequenceHeaderObu();if(!t)return;const{seq_profile:i,seq_level_idx:[r=0],max_frame_width_minus_1:n,max_frame_height_minus_1:o,color_config:{BitDepth:a,mono_chrome:s,subsampling_x:_,subsampling_y:c,chroma_sample_position:d,color_description_present_flag:f}}=t;let u,m,h,p;f?({color_primaries:u,transfer_characteristics:m,matrix_coefficients:h,color_range:p}=t.color_config):(u=l.ColorPrimaries.Bt709,m=l.TransferCharacteristics.Bt709,h=l.MatrixCoefficients.Bt709,p=!1);const b=n+1,g=o+1;this.#h(b,g);const x=["av01",i.toString(16),R(r)+(t.seq_tier[0]?"H":"M"),R(a),s?"1":"0",(_?"1":"0")+(c?"1":"0")+d.toString(),R(u),R(m),R(h),p?"1":"0"].join(".");this.#m.configure({codec:x,optimizeForLatency:!0})}decode(e){"configuration"!==e.type&&(this.#p(e.data),this.#m.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:e.data})))}}class S{#b;#m;constructor(e){this.#m=e}decode(e){if("configuration"===e.type)return this.#b=e.data,void this.configure(e.data);let t;void 0!==this.#b?(t=new Uint8Array(this.#b.length+e.data.length),t.set(this.#b,0),t.set(e.data,this.#b.length),this.#b=void 0):t=e.data,this.#m.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:t}))}}class U extends S{#m;#h;constructor(e,t){super(e),this.#m=e,this.#h=t}configure(e){const{profileIndex:t,constraintSet:i,levelIndex:r,croppedWidth:n,croppedHeight:o}=u(e);this.#h(n,o);const a="avc1."+w(t)+w(i)+w(r);this.#m.configure({codec:a,optimizeForLatency:!0})}}class G extends S{#m;#h;constructor(e,t){super(e),this.#m=e,this.#h=t}configure(t){const{generalProfileSpace:i,generalProfileIndex:r,generalProfileCompatibilitySet:n,generalTierFlag:o,generalLevelIndex:a,generalConstraintSet:s,croppedWidth:_,croppedHeight:c}=y(t);this.#h(_,c);const l=["hev1",["","A","B","C"][i]+r.toString(),P(e(n,0)),(o?"H":"L")+a.toString(),...Array.from(s,P)].join(".");this.#m.configure({codec:l,codedWidth:_,codedHeight:c,optimizeForLatency:!0})}}class N{listeners=[];constructor(){this.event=this.event.bind(this)}addEventListener(e){this.listeners.push(e);const t=()=>{const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)};return t.dispose=t,t}event=(e,t,...i)=>{const r={listener:e,thisArg:t,args:i};return this.addEventListener(r)};fire(e){for(const t of this.listeners.slice())t.listener.call(t.thisArg,e,...t.args)}dispose(){this.listeners.length=0}}const L=Symbol("undefined");class C extends N{#g=L;addEventListener(e){return this.#g!==L&&e.listener.call(e.thisArg,this.#g,...e.args),super.addEventListener(e)}fire(e){this.#g=e,super.fire(e)}}class I{#x;#E=new ReadableStream({start:e=>{this.#x=e},pull:e=>{e.enqueue(this.#T())}},{highWaterMark:0});#v=this.#E.getReader();#T;#y=0;#P;constructor(e,t){this.#T=e,this.#P=t}async borrow(){return(await this.#v.read()).value}return(e){this.#y<this.#P&&(this.#x.enqueue(e),this.#y+=1)}}class B{#w;#R;constructor(){"undefined"!=typeof OffscreenCanvas?this.#w=new OffscreenCanvas(1,1):(this.#w=document.createElement("canvas"),this.#w.width=1,this.#w.height=1),this.#R=this.#w.getContext("bitmaprenderer",{alpha:!1})}async capture(e){this.#w.width=e.displayWidth,this.#w.height=e.displayHeight;const t=await createImageBitmap(e);return this.#R.transferFromImageBitmap(t),this.#w instanceof OffscreenCanvas?await this.#w.convertToBlob({type:"image/png"}):new Promise(((e,t)=>{this.#w.toBlob((i=>{i?e(i):t(new Error("Failed to convert canvas to blob"))}),"image/png")}))}}const D=new I((()=>new B),4);class F{static get isSupported(){return void 0!==globalThis.VideoDecoder}static capabilities={h264:{},h265:{},av1:{}};#A;get codec(){return this.#A}#S;#U;get writable(){return this.#U}#G;#x;#N;get renderer(){return this.#N}#L=0;#C=0;get framesRendered(){return this.#C}#I=0;get framesSkipped(){return this.#I}#B=new C;get sizeChanged(){return this.#B.event}#D=0;get width(){return this.#D}#F=0;get height(){return this.#F}#m;#X=!1;#k;#M;#z=0;constructor({codec:e,renderer:o}){switch(this.#A=e,this.#N=o,this.#m=new VideoDecoder({output:e=>{if(this.#M?.close(),this.#M=e.clone(),this.#X)return this.#k&&(this.#k.close(),this.#I+=1),void(this.#k=e);this.#H(e)},error:e=>{this.#O(e)}}),this.#A){case t:this.#S=new U(this.#m,this.#h);break;case i:this.#S=new G(this.#m,this.#h);break;case r:this.#S=new A(this.#m,this.#h);break;default:throw new Error(`Unsupported codec: ${this.#A}`)}this.#U=new n({start:e=>{this.#G?e.error(this.#G):this.#x=e},write:e=>{this.#S.decode(e)}}),this.#W()}#O(e){if(this.#x)try{this.#x.error(e)}catch{}else this.#G=e}async#H(e){try{if(this.#X=!0,this.#h(e.displayWidth,e.displayHeight),await this.#N.draw(e),this.#L+=1,e.close(),this.#k){const e=this.#k;this.#k=void 0,await this.#H(e)}this.#X=!1}catch(t){this.#O(t)}}#h=(e,t)=>{this.#N.setSize(e,t),this.#D=e,this.#F=t,this.#B.fire({width:e,height:t})};#W=()=>{this.#L>0&&(this.#C+=1,this.#I+=this.#L-1,this.#L=0),this.#z=requestAnimationFrame(this.#W)};async snapshot(){const e=this.#M;if(!e)return;const t=await D.borrow(),i=await t.capture(e);return D.return(t),i}dispose(){cancelAnimationFrame(this.#z),"closed"!==this.#m.state&&this.#m.close(),this.#k?.close(),this.#M?.close()}}var X,k={exports:{}},M={exports:{}};function z(){return X||(X=1,function(){function e(e,t){throw new Error("abstract")}e.prototype.drawFrame=function(e){throw new Error("abstract")},e.prototype.clear=function(){throw new Error("abstract")},M.exports=e}()),M.exports}var H,O,W,Y={exports:{}},q={exports:{}},V={exports:{}};function j(){return O||(O=1,H||(H=1,V.exports=function(e){for(var t=0,i=e>>1;0!=i;)i>>=1,t++;if(e!==1<<t)throw"chroma plane dimensions must be power of 2 ratio to luma plane dimensions; got "+e;return t}),e=V.exports,q.exports={convertYCbCr:function(t,i){var r=0|t.format.width,n=0|t.format.height,o=0|e(t.format.width/t.format.chromaWidth),a=0|e(t.format.height/t.format.chromaHeight),s=t.y.bytes,_=t.u.bytes,c=t.v.bytes,l=0|t.y.stride,d=0|t.u.stride,f=0|t.v.stride,u=r<<2,m=0,h=0,p=0,b=0,g=0,x=0,E=0,T=0,v=0,y=0,P=0,w=0,R=0,A=0,S=0,U=0,G=0,N=0;if(1==o&&1==a)for(E=0,T=u,N=0,U=0;U<n;U+=2){for(p=(h=U*l|0)+l|0,b=N*d|0,g=N*f|0,S=0;S<r;S+=2)v=0|_[b++],w=(409*(y=0|c[g++])|0)-57088|0,R=(100*v|0)+(208*y|0)-34816|0,A=(516*v|0)-70912|0,P=298*s[h++]|0,i[E]=P+w>>8,i[E+1]=P-R>>8,i[E+2]=P+A>>8,E+=4,P=298*s[h++]|0,i[E]=P+w>>8,i[E+1]=P-R>>8,i[E+2]=P+A>>8,E+=4,P=298*s[p++]|0,i[T]=P+w>>8,i[T+1]=P-R>>8,i[T+2]=P+A>>8,T+=4,P=298*s[p++]|0,i[T]=P+w>>8,i[T+1]=P-R>>8,i[T+2]=P+A>>8,T+=4;E+=u,T+=u,N++}else for(x=0,U=0;U<n;U++)for(G=0,m=U*l|0,b=(N=U>>a)*d|0,g=N*f|0,S=0;S<r;S++)v=0|_[b+(G=S>>o)],w=(409*(y=0|c[g+G])|0)-57088|0,R=(100*v|0)+(208*y|0)-34816|0,A=(516*v|0)-70912|0,P=298*s[m++]|0,i[x]=P+w>>8,i[x+1]=P-R>>8,i[x+2]=P+A>>8,x+=4}}),q.exports;var e}function K(){return W||(W=1,function(){var e=z(),t=j();function i(e){var i=this,r=e.getContext("2d"),n=null,o=null,a=null;return i.drawFrame=function(i){var s=i.format;e.width===s.displayWidth&&e.height===s.displayHeight||(e.width=s.displayWidth,e.height=s.displayHeight),null!==n&&n.width==s.width&&n.height==s.height||function(e,t){for(var i=(n=r.createImageData(e,t)).data,o=e*t*4,a=0;a<o;a+=4)i[a+3]=255}(s.width,s.height),t.convertYCbCr(i,n.data);var _,c,l,d=s.cropWidth!=s.displayWidth||s.cropHeight!=s.displayHeight;d?(o||(c=s.cropWidth,l=s.cropHeight,(o=document.createElement("canvas")).width=c,o.height=l,a=o.getContext("2d")),_=a):_=r,_.putImageData(n,-s.cropLeft,-s.cropTop,s.cropLeft,s.cropTop,s.cropWidth,s.cropHeight),d&&r.drawImage(o,0,0,s.displayWidth,s.displayHeight)},i.clear=function(){r.clearRect(0,0,e.width,e.height)},i}i.prototype=Object.create(e.prototype),Y.exports=i}()),Y.exports}var $,J,Q,Z,ee,te,ie,re,ne={exports:{}};function oe(){return Q||(Q=1,function(){var e=z(),t=J?$:(J=1,$={vertex:"precision mediump float;\n\nattribute vec2 aPosition;\nattribute vec2 aLumaPosition;\nattribute vec2 aChromaPosition;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vLumaPosition = aLumaPosition;\n    vChromaPosition = aChromaPosition;\n}\n",fragment:"// inspired by https://github.com/mbebenita/Broadway/blob/master/Player/canvas.js\n\nprecision mediump float;\n\nuniform sampler2D uTextureY;\nuniform sampler2D uTextureCb;\nuniform sampler2D uTextureCr;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n   // Y, Cb, and Cr planes are uploaded as ALPHA textures.\n   float fY = texture2D(uTextureY, vLumaPosition).w;\n   float fCb = texture2D(uTextureCb, vChromaPosition).w;\n   float fCr = texture2D(uTextureCr, vChromaPosition).w;\n\n   // Premultipy the Y...\n   float fYmul = fY * 1.1643828125;\n\n   // And convert that to RGB!\n   gl_FragColor = vec4(\n     fYmul + 1.59602734375 * fCr - 0.87078515625,\n     fYmul - 0.39176171875 * fCb - 0.81296875 * fCr + 0.52959375,\n     fYmul + 2.017234375   * fCb - 1.081390625,\n     1\n   );\n}\n",vertexStripe:"precision mediump float;\n\nattribute vec2 aPosition;\nattribute vec2 aTexturePosition;\nvarying vec2 vTexturePosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vTexturePosition = aTexturePosition;\n}\n",fragmentStripe:"// extra 'stripe' texture fiddling to work around IE 11's poor performance on gl.LUMINANCE and gl.ALPHA textures\n\nprecision mediump float;\n\nuniform sampler2D uStripe;\nuniform sampler2D uTexture;\nvarying vec2 vTexturePosition;\nvoid main() {\n   // Y, Cb, and Cr planes are mapped into a pseudo-RGBA texture\n   // so we can upload them without expanding the bytes on IE 11\n   // which doesn't allow LUMINANCE or ALPHA textures\n   // The stripe textures mark which channel to keep for each pixel.\n   // Each texture extraction will contain the relevant value in one\n   // channel only.\n\n   float fLuminance = dot(\n      texture2D(uStripe, vTexturePosition),\n      texture2D(uTexture, vTexturePosition)\n   );\n\n   gl_FragColor = vec4(0, 0, 0, fLuminance);\n}\n"});function i(e){var r,n,o=this,a=i.contextForCanvas(e);if(null===a)throw new Error("WebGL unavailable");function s(e,t){var i=a.createShader(e);if(a.shaderSource(i,t),a.compileShader(i),!a.getShaderParameter(i,a.COMPILE_STATUS)){var r=a.getShaderInfoLog(i);throw a.deleteShader(i),new Error("GL shader compilation for "+e+" failed: "+r)}return i}var _,c,l,d,f,u,m,h,p,b,g=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),x={},E={},T={};function v(e,t){return x[e]&&!t||(x[e]=a.createTexture()),x[e]}function y(e,t,r,n,o){var s=!x[e]||t,_=v(e,t);if(a.activeTexture(a.TEXTURE0),i.stripe){var c=!x[e+"_temp"]||t,l=v(e+"_temp",t);a.bindTexture(a.TEXTURE_2D,l),c?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,r/4,n,0,a.RGBA,a.UNSIGNED_BYTE,o)):a.texSubImage2D(a.TEXTURE_2D,0,0,0,r/4,n,a.RGBA,a.UNSIGNED_BYTE,o);var d=x[e+"_stripe"],f=!d||t;f&&(d=v(e+"_stripe",t)),a.bindTexture(a.TEXTURE_2D,d),f&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,r,1,0,a.RGBA,a.UNSIGNED_BYTE,function(e){if(T[e])return T[e];for(var t=e,i=new Uint32Array(t),r=0;r<t;r+=4)i[r]=255,i[r+1]=65280,i[r+2]=16711680,i[r+3]=4278190080;return T[e]=new Uint8Array(i.buffer)}(r)))}else a.bindTexture(a.TEXTURE_2D,_),s?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,r,n,0,a.ALPHA,a.UNSIGNED_BYTE,o)):a.texSubImage2D(a.TEXTURE_2D,0,0,0,r,n,a.ALPHA,a.UNSIGNED_BYTE,o)}function P(e,t,i,r){var o=x[e];a.useProgram(n);var s=E[e];s&&!t||(a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,o),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,i,r,0,a.RGBA,a.UNSIGNED_BYTE,null),s=E[e]=a.createFramebuffer()),a.bindFramebuffer(a.FRAMEBUFFER,s),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,o,0);var m=x[e+"_temp"];a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,m),a.uniform1i(u,1);var h=x[e+"_stripe"];a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,h),a.uniform1i(f,2),a.bindBuffer(a.ARRAY_BUFFER,_),a.enableVertexAttribArray(c),a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,l),a.enableVertexAttribArray(d),a.vertexAttribPointer(d,2,a.FLOAT,!1,0,0),a.viewport(0,0,i,r),a.drawArrays(a.TRIANGLES,0,g.length/2),a.bindFramebuffer(a.FRAMEBUFFER,null)}function w(e,t,i){a.activeTexture(t),a.bindTexture(a.TEXTURE_2D,x[e]),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.uniform1i(a.getUniformLocation(r,e),i)}function R(e,t){var i=s(a.VERTEX_SHADER,e),r=s(a.FRAGMENT_SHADER,t),n=a.createProgram();if(a.attachShader(n,i),a.attachShader(n,r),a.linkProgram(n),!a.getProgramParameter(n,a.LINK_STATUS)){var o=a.getProgramInfoLog(n);throw a.deleteProgram(n),new Error("GL program linking failed: "+o)}return n}return o.drawFrame=function(s){var x=s.format,E=!r||e.width!==x.displayWidth||e.height!==x.displayHeight;if(E&&(e.width=x.displayWidth,e.height=x.displayHeight,o.clear()),r||function(){if(i.stripe){n=R(t.vertexStripe,t.fragmentStripe),a.getAttribLocation(n,"aPosition"),l=a.createBuffer();var e=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);a.bindBuffer(a.ARRAY_BUFFER,l),a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW),d=a.getAttribLocation(n,"aTexturePosition"),f=a.getUniformLocation(n,"uStripe"),u=a.getUniformLocation(n,"uTexture")}r=R(t.vertex,t.fragment),_=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,_),a.bufferData(a.ARRAY_BUFFER,g,a.STATIC_DRAW),c=a.getAttribLocation(r,"aPosition"),m=a.createBuffer(),h=a.getAttribLocation(r,"aLumaPosition"),p=a.createBuffer(),b=a.getAttribLocation(r,"aChromaPosition")}(),E){var T=function(e,t,i){var r=x.cropLeft/i,n=(x.cropLeft+x.cropWidth)/i,o=(x.cropTop+x.cropHeight)/x.height,s=x.cropTop/x.height,_=new Float32Array([r,o,n,o,r,s,r,s,n,o,n,s]);a.bindBuffer(a.ARRAY_BUFFER,e),a.bufferData(a.ARRAY_BUFFER,_,a.STATIC_DRAW)};T(m,0,s.y.stride),T(p,0,s.u.stride*x.width/x.chromaWidth)}y("uTextureY",E,s.y.stride,x.height,s.y.bytes),y("uTextureCb",E,s.u.stride,x.chromaHeight,s.u.bytes),y("uTextureCr",E,s.v.stride,x.chromaHeight,s.v.bytes),i.stripe&&(P("uTextureY",E,s.y.stride,x.height),P("uTextureCb",E,s.u.stride,x.chromaHeight),P("uTextureCr",E,s.v.stride,x.chromaHeight)),a.useProgram(r),a.viewport(0,0,e.width,e.height),w("uTextureY",a.TEXTURE0,0),w("uTextureCb",a.TEXTURE1,1),w("uTextureCr",a.TEXTURE2,2),a.bindBuffer(a.ARRAY_BUFFER,_),a.enableVertexAttribArray(c),a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,m),a.enableVertexAttribArray(h),a.vertexAttribPointer(h,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,p),a.enableVertexAttribArray(b),a.vertexAttribPointer(b,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLES,0,g.length/2)},o.clear=function(){a.viewport(0,0,e.width,e.height),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT)},o.clear(),o}i.stripe=!1,i.contextForCanvas=function(e){var t={preferLowPowerToHighPerformance:!0,powerPreference:"low-power",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!0};return e.getContext("webgl",t)||e.getContext("experimental-webgl",t)},i.isAvailable=function(){var e,t=document.createElement("canvas");t.width=1,t.height=1;try{e=i.contextForCanvas(t)}catch(c){return!1}if(e){var r=e.TEXTURE0,n=e.createTexture(),o=new Uint8Array(16),a=i.stripe?1:4,s=i.stripe?e.RGBA:e.ALPHA,_=i.stripe?e.NEAREST:e.LINEAR;return e.activeTexture(r),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,_),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,_),e.texImage2D(e.TEXTURE_2D,0,s,a,4,0,s,e.UNSIGNED_BYTE,o),!e.getError()}return!1},i.prototype=Object.create(e.prototype),ne.exports=i}()),ne.exports}function ae(){if("undefined"!=typeof document)return document.createElement("canvas");if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(1,1);throw new Error("no canvas input found nor any canvas can be created")}Z||(Z=1,ee=z(),te=K(),ie=oe(),re={FrameSink:ee,SoftwareFrameSink:te,WebGLFrameSink:ie,attach:function(e,t){return("webGL"in(t=t||{})?t.webGL:ie.isAvailable())?new ie(e,t):new te(e,t)}},k.exports=re),k.exports;class se{#w;get canvas(){return this.#w}constructor(e){this.#w=e||ae()}setSize(e,t){this.#w.width===e&&this.#w.height===t||(this.#w.width=e,this.#w.height=t)}}const _e=Promise.resolve();function ce(e,t){const i={powerPreference:"low-power",alpha:!1,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!!t};return e.getContext("webgl2",i)||e.getContext("webgl",i)}class le extends se{static vertexShaderSource="\n        attribute vec2 xy;\n\n        varying highp vec2 uv;\n\n        void main(void) {\n            gl_Position = vec4(xy, 0.0, 1.0);\n            // Map vertex coordinates (-1 to +1) to UV coordinates (0 to 1).\n            // UV coordinates are Y-flipped relative to vertex coordinates.\n            uv = vec2((1.0 + xy.x) / 2.0, (1.0 - xy.y) / 2.0);\n        }\n";static fragmentShaderSource="\n        varying highp vec2 uv;\n\n        uniform sampler2D texture;\n\n        void main(void) {\n            gl_FragColor = texture2D(texture, uv);\n        }\n";static get isSupported(){return!!ce(ae())}#R;constructor(e,t){super(e);const i=ce(this.canvas,t);if(!i)throw new Error("WebGL not supported");this.#R=i;const r=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(r,le.vertexShaderSource),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(r));const n=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(n,le.fragmentShaderSource),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(n));const o=i.createProgram();if(i.attachShader(o,r),i.attachShader(o,n),i.linkProgram(o),!i.getProgramParameter(o,i.LINK_STATUS))throw new Error(i.getProgramInfoLog(o));i.useProgram(o);const a=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),i.STATIC_DRAW);const s=i.getAttribLocation(o,"xy");i.vertexAttribPointer(s,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(s);const _=i.createTexture();i.bindTexture(i.TEXTURE_2D,_),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)}draw(e){const t=this.#R;return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.drawArrays(t.TRIANGLE_FAN,0,4),_e}}self.addEventListener("message",(async e=>{const{codec:t,canvas:i,stream:r}=e.data,n=new le(i),o=new F({codec:t,renderer:n});o.sizeChanged((({width:e,height:t})=>{postMessage({width:e,height:t})}));try{await r.pipeTo(o.writable)}catch(a){console.error("Stream pipe error:",a),postMessage({error:a instanceof Error?a.message:"Unknown error occurred"})}}))}();
